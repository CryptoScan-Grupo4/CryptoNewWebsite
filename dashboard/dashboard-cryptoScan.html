<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <script src="../js/menu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/dashboard-cryptoScan.css">
    <!-- Boxiocns CDN Link -->
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../img/logo.png">
</head>

<body>
    <div class="sidebar close">
        <div class="logo-details">
            <i class='bx bx-code-alt'></i>
            <span class="logo_name">Crypto Scan</span>
        </div>
        <ul class="nav-links">
            <li>
                <a href="dashboard-cryptoScan.html">
                    <i class='bx bx-grid-alt'></i>
                    <span class="link_name">Painel</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="dashboard-cryptoScan.html">Painel</a></li>
                </ul>
            </li>
            <li>
                <div class="iocn-link">
                    <a href="#">
                        <i class='bx bxs-business'></i>
                        <span class="link_name">Setor 1</span>
                    </a>
                    <i class='bx bxs-chevron-down arrow'></i>
                </div>
                <ul class="sub-menu">
                    <li><a class="link_name" href="#">Setor 1</a></li>
                    <li><a href="./dashboardMonitoramento.html">M치quina 1</a></li>
                    <li><a href="#">M치quina 2</a></li>
                </ul>
            </li>
            <li>
                <div class="iocn-link">
                    <a href="#">
                        <i class='bx bxs-business'></i>
                        <span class="link_name">Setor 2</span>
                    </a>
                    <i class='bx bxs-chevron-down arrow'></i>
                </div>
                <ul class="sub-menu">
                    <li><a class="link_name" href="#">Setor 2</a></li>
                    <li><a href="#">M치quina 1</a></li>
                    <li><a href="#">M치quina 2</a></li>
                    <li><a href="#">M치quina 3</a></li>
                    <li><a href="#">M치quina 4</a></li>
                </ul>
            </li>
            <li>
                <a href="/cadastroFuncionario.html">
                    <i class='bx bx-user'></i>
                    <span class="link_name">Cadastrar Funcion치rios</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="/cadastroFuncionario.html">Cadastrar Funcion치rios</a></li>
                </ul>
            </li>
            <li>
                <a href="../setorCRUD.html">
                    <i class='bx bx-user'></i>
                    <span class="link_name">Cadastrar Setor</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="../setorCRUD.html">Cadastrar Setor</a></li>
                </ul>
            </li>
            <li>
                <a href="../computadorCrud.html">
                    <i class='bx bx-user'></i>
                    <span class="link_name">Cadastrar Computador</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="../computadorCrud.html">Cadastrar Computador</a></li>
                </ul>
            </li>
            <li>
                <a href="#">
                    <i class='bx bx-cog'></i>
                    <span class="link_name">Setting</span>
                </a>
                <ul class="sub-menu blank">
                    <li><a class="link_name" href="#">Setting</a></li>
                </ul>
            </li>
            <li>
                <div class="profile-details">
                    <div class="profile-content">
                    </div>
                    <div class="name-job">
                        <div class="profile_name" id="profile_name"></div>
                    </div>
                    <i class='bx bx-log-out'></i>
                </div>
            </li>
        </ul>
    </div>
    <section class="home-section">
        <div class="home-content">
            <i class='bx bx-menu'></i>
        </div>

        <div class="container">
            <!-- card1 -->
            <div class="divs">
                <div class="titulo">
                    <h1>Quantidade de setores</h1>
                </div>
                <div class="dunet">
                    <div class="dentro">
                        <p id="qtd_setores"></p>
                    </div>
                </div>
            </div>


            <!-- card3 -->
            <div class="card">
                <div class="titulo-card">
                    <h1>Porcentagem de Uso da Rede</h1>
                </div>

                <p id="porcentagem-rede"></p>

                <div id="qtd-recebidos">
                    Recebidos:
                    <span>
                        16,50
                    </span>
                </div>
                <div id="qtd-enviados">
                    Enviados:
                    <span>
                        16,50
                    </span>
                </div>

            </div>


            <!-- card2 -->
            <div class="divs">
                <div class="titulo">
                    <h1>Quantidade de m치quinas</h1>
                </div>
                <div class="dunet">
                    <div class="dentro">
                        <p id="qtd_maquinas"></p>
                    </div>
                </div>
            </div>
        </div>


        <div class="container-tabela">

            <table>
                <caption class="titulo-tabela">
                    Desempenho das M치quinas
                </caption>

                <thead>
                    <tr>
                        <th class="setor">Setor</th>
                        <th>Serial da m치quina</th>
                        <th class="situacao">Situa칞칚o <i class='bx bx-info-circle' id="tooltip">
                                <span class="tooltiptext">Uma m치quina com o indicador vermelho 游댮 칠 um alerta de
                                    <b>mau</b>
                                    funcionamento em algum componente. <br>
                                    <b> Recomendamos dar uma olhada! </b>
                                </span>
                            </i> </th>
                    </tr>
                </thead>

                <!-- <tr>
                    <td>1</td>
                    <td class="td-maquina"><a href="cards.html">455</a></td>
                    <td>OK</td>

                </tr>

                <tr>
                    <td>2</td>
                    <td class="td-maquina"><a href="">477</a></td>
                    <td>OK</td>

                </tr>
                <tr>
                    <td>2</td>
                    <td class="td-maquina"><a href="">477</a></td>
                    <td>X</td>

                </tr>


                <tr>
                    <td>1</td>
                    <td class="td-maquina"><a href="">455</a></td>
                    <td>OK</td>

                </tr>
                <tr>
                    <td>1</td>
                    <td class="td-maquina"><a href="">477</a></td>
                    <td>X</td>

                </tr>
                <tr>
                    <td>2</td>
                    <td class="td-maquina"><a href="">477</a></td>
                    <td>OK</td>

                </tr> -->
                <tbody id="mainTableDatas">

                </tbody>

            </table>
        </div>

    </section>




</body>

</html>

<!-- <script>
    function teste() {
        alert("foi")
    }
</script> -->
<script src="../node_modules/axios/dist/axios.min.js"></script>
<script>
    let arrow = document.querySelectorAll(".arrow")
    for (var i = 0; i < arrow.length; i++) {
        arrow[i].addEventListener("click", (e) => {
            let arrowParent = e.target.parentElement.parentElement//selecting main parent of arrow
            arrowParent.classList.toggle("showMenu")
        })
    }
    let sidebar = document.querySelector(".sidebar")
    let sidebarBtn = document.querySelector(".bx-menu")
    console.log(sidebarBtn)
    sidebarBtn.addEventListener("click", () => {
        sidebar.classList.toggle("close")
    })
    profile_name.innerHTML = sessionStorage.NOME_FUNCIONARIO

    async function getMainData() {
        try {

            let soma = 0
            let tablesRows = ''
            const response = await axios.get('http://34.232.200.187:3000/painel', [])

            console.log(response.data)
            qtd_setores.innerHTML = response.data.length

            response.data.forEach(data => {
                soma += data._count.computador
                const computador = data.computador.map(cpt => cpt)
                const setup = computador.map((cpt) => cpt.setup)
                const componente = setup.map((stp) => stp[0])
                const medidas = componente[0].componente.map((medida) => medida.medida)
                const medidasCapturadas = medidas.map(ult => ult)


                console.log(computador)
                console.log(setup)
                console.log(componente)
                console.log(medidasCapturadas.map(mds => mds))

                const status = medidasCapturadas


                tablesRows += `<tr>
                    <td>${data.idSetor}</td>
                    <td class="td-maquina">${setup.serial}</td>
                     </tr>`
            })
            qtd_maquinas.innerHTML = soma
            mainTableDatas.innerHTML = tablesRows
        } catch (error) {
            console.error(error)
        }
    }

    getMainData()
</script>
